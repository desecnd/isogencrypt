#!/usr/bin/sage

from msidh import MSIDH, MSIDHBenchTask
from sage.all import GF, EllipticCurve, proof, set_random_seed, order_from_multiple
# https://stackoverflow.com/a/25823885
from timeit import default_timer as timer
import sys

# Speed up the calculations
proof.all("false")

BENCH_TASKS = [
    {
        "t": 10,
        "a": "6",
        "xP": "34882963342*i + 11009952307",
        "yP": "30454453365*i + 30634454498",
        "xQ": "5815710722*i + 25469191237",
        "yQ": "9491984446*i + 29828096606",
        "xR": "33157652683*i + 30856582984",
        "yR": "4401132811*i + 27498492169"
    },
    {
        "t": 20,
        "a": "6",
        "xP": "338349975578673364439667735*i + 19641384473737785853210026",
        "yP": "119948032263670820698654317*i + 548895328653609219101887146",
        "xQ": "997802420519331829720147294*i + 712588076275425039628686865",
        "yQ": "155069277313194366202866840*i + 668535605405918089701594989",
        "xR": "63354760990773317877394341*i + 601231547199627183959416819",
        "yR": "179448016517355932983911506*i + 220556590276205379178542351"
    },
    {
        "t": 30,
        "a": "6",
        "xP": "32381872305678490404833289490608450363172933700*i + 38566570518230924614310417068523536638018699310",
        "yP": "51454160553705302795561802082188918906573282935*i + 46999345345209075217588309637506871396736048585",
        "xQ": "29454235622145096109316297773070819902970029047*i + 17242937661247998401353436361850378272505949076",
        "yQ": "4027506100385014783073063257216469725014255007*i + 40503840888595183524703631351014003574434214416",
        "xR": "29746668073241433805825980414131965658693152428*i + 17760541352524573821929254886145960108078787218",
        "yR": "32059355061950859614698660924026064145498522715*i + 56106642545465685557315974910295572193326873612"
    },
    {
        "t": 40,
        "a": "6",
        "xP": "2209907146324919043824150335112187259842599962176225475376631027238660*i + 1953434190631308086816401353351952987681763800074233506743275726580155",
        "yP": "1465562222467248040754512029039419737775794647502108582518641511155183*i + 813917535949451518673601293426963255371043026938592713273636822289502",
        "xQ": "3462688294810209630890903945429074921000174792450159228221123295406262*i + 1345012478516739556437784038085897215207799031540297475161770998390588",
        "yQ": "3749469857004876715185030009017577656151444503005202866635672569549902*i + 4228251980890388575831976445548707049457989216308967136821790168418764",
        "xR": "2486727957703547405312737722589730610730130393337080776321309349722537*i + 2592560467247386239141839886260312656561967034623757482392498634901863",
        "yR": "3278055720235788275293278125318492805639434659531399998788228243327659*i + 2745441573641278094788096708433855099758007916877226516084582036408579"
    },
    {
        "t": 50,
        "a": "6",
        "xP": "35088104745272874100432816351948372035745517958108235708758976299094918348228096944077467715*i + 15365446930633303201895007167809227886058040878093994017418135304283338944213232905502711031",
        "yP": "551631184302138320788653635704772642706421086878010301904411262178472235633782528786922360*i + 112637836682539211242035716589576701068818918880244093409593417686056584175972025861601966652",
        "xQ": "146804018628951679655901347395118426426250136191890731520360992830614660853611948668267597730*i + 38636078394029261460166588898694320014438563812162888240336926503976817472047750780159885022",
        "yQ": "119140674478669284458808679313262499912659803542712457104516813536551034791473914858162603081*i + 53101586187423577076349464135494593992817849689050091011409704208199423773276310367528146102",
        "xR": "84531338933437697150615729340438794529648104947580979837721455835848728671675458662564183764*i + 121445295531036653443870641759745399676098177441967963184895362400984590200662079759496092514",
        "yR": "64819472576126457102447597890512330843823875578183583277197660929500936889408971603279233092*i + 112497433898384467952070509287847802280275382644768925214769290575131236501330866360321907402"
    },
    {
        "t": 60,
        "a": "6",
        "xP": "119049619747071683394881639988180179646969904635673760495524333906901564974875981459112080303803772018868886060868939*i + 355735187024971084220540871962007123436473894118695927566213010885442420957153433905306464886802721327952730228360453",
        "yP": "81682009730442677205093748298427244617584482430322756751499209080118471320692146206697304182353646450331731706719083*i + 156139813292719501793796107669934703583879156868895234789358436561193405091725191538175306907540153681618287084585902",
        "xQ": "5600909484262642901484197399022613281483051404021116769630110791012716736291880475090183610542802406681046668745409*i + 111877494801781216976522948833892636623065362685346769637346798536038939636422185324637069213658956292790003326159269",
        "yQ": "438856592059352883866393479974517183443680980896473583582888883365427263202677951229927007499449174701182602595773872*i + 290832394881462077988768832885385405655105572889654503065191928059435662551454293068292873852557460404747965573959887",
        "xR": "275076359413466473100949185937693000877343464828823360092640985278073149573272969043800921140614084066814883639714166*i + 325906223621357365790084054645235686910175336325416844735349448359930668653019026150506847132727076216031833168458810",
        "yR": "279933895865599762161229038767420634242720772578025946742089453302076430660533284707883171744658534763702915660158347*i + 12225993015848465375864915930654996079620406450566266413075809920782915499211588578165527098283665290384369687831087"
    },
    {
        "t": 70,
        "a": "6",
        "xP": "1011602934832824691807237744814947065412306644789773229277293514589154262922615293693523234948610471429916973576015004323641067487795115708567*i + 4396251157726805638980921716378960587226478667806655287188384936412172832051496023578844865765526883091167224716101898657899638635361057340521",
        "yP": "11806210943516546464563479650604385088180901064526759685557164469709223452986970185024870129194225778946636456544548487878536967043106867108124*i + 7701694686789956328335537761575033329102745864717572464931292009207570371056517642614003524513989412756190497643156069081064730268278768541681",
        "xQ": "12464665044733141436524017757668636639237142833886665054374997125442656714482164663645727554895543475785171084987099966483477370758679996405868*i + 9118028298228585027045223883908830073531790079237343333095074985536699271702706713269732654451418377282480734198170484671491117340108109544565",
        "yQ": "29680614651424223828828860214332507414962318804874089729585056586303006511925524983971265736469975696444752535458599777341120997505796244355*i + 10866797249578563068194123540278808780565926473200567148394305076312509694031894091822965567723070758117329132609641705591464259017489915740561",
        "xR": "2028897192824632291691848503616780551037326124851487670151011226330708714805590196929737463075454905537889907958130110894814023877465712989941*i + 11109534930948317846094540447158512196806924852780301907392043634726701651619967332531601340461138297662978045257763087389307366985860787195923",
        "yR": "5824300230117030012453871662239790641772092305740593974021988456993296091550541093958814250124911776957506873222458721282468045174723850866066*i + 15465663576945516531024649847398417910493340507439819142387491667451644346645828747242504083252796813089675820241039323810708748182370569630777"
    },
    {
        "t": 80,
        "a": "6",
        "xP": "439672429519846633531768010469150069703977784858689646264211003960740000812153131118789259796670349157394517788564953808792757360145007194397765373589271011753230096998*i + 534830668712654956567919696955573013636396179651559535091210281604657218755522857327449910679520653084990004488678372125632777448109925859923477687717932877873887085224",
        "yP": "304232813592446764401636942049942941935244416041622526870132460868445177476016645740201386022905528281519395676713372873051582883229999463560261213951587848958100286417*i + 15979620991690891900235304777041217815544709781907030983580438229991947767180801930203755688383945938873241667163300622440774896995993396519695406294652400665407044137",
        "xQ": "731398681635757899416305796639023725110344478565432940567435017413449713798663097231452879243000861906836265417428329352547978369084930109322237972608912793105440711132*i + 756187350765126917496939002663454308468343169000416893425458710224555449601112511342762169425263757925978421347008658338264774036152281938388647908401264715858144973992",
        "yQ": "508796546097302038807329894070100702372047975352423360857738086164104848405572862670918618919957300022772710661849342553961918032104261400579746574184836850860467882651*i + 13702402076451313424171185225988675377724456364046445749205799737616680096790432663706171834382784007083735918467482951770963992091332148197964329233016282456925161132",
        "xR": "709107884329571511526733068737022865647716721775328381204766027756637595496992570419529895128051054279350095819625870783068166292262108000673882218699260037870010013029*i + 122953889609694443684760509384844645755355316891572623373428189411482124824616625140341983759704747969541951893145332062753331173636951117377109006559236729182414112114",
        "yR": "281230531748678224118672546229189160891159923317064608716103613232788891031877128729515436666631199717052404408563895658766388366778862865072729307104468547314739782757*i + 402274654022726969483009606950505469247503168892786397947562336275871835957015201972824294746319065795505366660479175255868124440870939501237061639785156088789705349293"
    },
    {
        "t": 90,
        "a": "6",
        "xP": "155752191712986171618657647906761455932451225101483138989482602464286208600602753464511471739384930262434385057777203304095663118815641893873245909019525966343635172535940210063909898656083508627*i + 2087515589012106277192006148889812592930456426232411801643374913595380310847535944349362031788166288778679440604488028096273746602208875205423617763214945291589966780276333136019633601706219466",
        "yP": "153636943625869882730624647084149488205283757998925176841278371506437009743834302540387421339973187316975817655796548338945075744380955431350499356219873682950894886002516720286999639158819385539*i + 24837316852292154371364650225561380621837226831014818654521478202215221541240010067354603520666334447289925499786634963036550590644965641562610313599199900453901566600475724270673164798223591610",
        "xQ": "138838163545386257939776737481778744029160712698880013643733263514115168800810750889247668725828722014903197423662357303753400639397487743924174625195217448769961061946405842768423405648042884510*i + 103659979593546017148644021706245268318071184485695215068454618033765769355828119535207186343930640016723371822792763271054913199393166286786041685484383476163594523235661483597009478399234407031",
        "yQ": "2936308771696325133799392289324020663482103540626058241447786615085272668905235932300552221598903171576557034124878361333151391658560481400652128845431563402417090176678778316915423657694251663*i + 95209054311141608068052763410330394133956476260321561733128501872175747927834508125131993450490697056102479177156056834215843260191883744043651001798656848508605622403431417188016919199773558783",
        "xR": "36490178547926929815865392901338183410853485839226427071327106630274418043494610477916371893003527765228207200125494935722879160191222671681325331887398384572868225643651425458729729204657271363*i + 106882655328020381630978737011350523676109074890494170193825512600807590632876751122237910281074837190484196105627093609139142603287927571644316807034655074195645916714300700992042354451716385627",
        "yR": "73585868246084601977899130843650586169773375612776595068691028599388979626396857511679132506724141659405757000454400576618498969906201864927862859873166848817762472088556169519054114633443998716*i + 133215885735404092832320491644597284407561260996940720946074799897114528916472378498004943047147204680331827200389643212050293338453949044011984307906583195907460461559697319999534724439866474193"
    },
    {
        "t": 100,
        "a": "6",
        "xP": "676782264267647704374841078583377129084920411368462533161975883862106168381374621964630435711031310199890121669098735728601662060520619786791770866788191063158114472432232379973464280756719439507936879154054541559903789696*i + 282112944123676408609495261586712812203713408247395183175137461096334546904020125022139160812389963422190307194936726367122106029835150671283058126220448180766790907504639045538223643393944677488032699431588822694429908807",
        "yP": "644459567203313069294713837919560702356472559157572873783480341127557863510478950404455286172219270139555233412901223270118504060145500235833323744221045499535288087931777861098078454401222587718214144731166508514191495390*i + 829097256434896464228385801510194166655975125992860018645969838217929377319940792495281899188975797809851871936285035546197645733486776694159355475345687619401497111937707990362167212992806277418686566502435862502436601763",
        "xQ": "32367356782289105770954104254110078052637346772802896266479595133195546236262364823552492761142608582981335317969767811450296025879972269381965001149304673765189124838440280486311825139786957074937789460893921127939478578*i + 790659894435988541838965364489716509500495044678106771763637330713687360367120363885943452946719921091998096686199913863567843743937032074428640648704582813280464335938644280877068848855009972350768489454580631049447855480",
        "yQ": "381202203812582088809420237179890283851579123874515109059893385675948123486441577895459408653109555129426450644620114314326283255246448606586041822677660554619471784506395798989268596147871208991939298524297917547331529872*i + 317544183884342804940702577140102655080538193158467788576507631575273069144900836500612149361902044670630599011640778754885472858054526924365402511527492512348945786171659888242990796647994487318814207163988073812873381017",
        "xR": "555681514866784111235320795562790330048828033500308950298140884480073206729285147934444814579066077321513364911998778834660073778528074528072850931277906825763407742457542084527734140433441001321709155289976095024762678146*i + 699784705541245626746972809851120549881104679311434317817339274196308856576144399491580834186237888201147647408270897063702387883947094884736964822165723421108946083854470305412641278697960284272294864849781531780078369445",
        "yR": "489219093164410849576199497472271320042651347505312691127763083135099560351844789154376283655191176911107392990426236946468024181074193345041509754506520392982307259479649220333985874332245967790916584105759286067222669084*i + 608412111643973680145300850472045563952163911353163779266333411403621324018984199363110481470969522405578314216751324998776534768667221918167169980216088921976903783611415246768282490664237595981786382840271473082744537028"
    },
    {
        "t": 110,
        "a": "6",
        "xP": "272682221176826240294802857640794326060444974612315563002764027905577977150333673396359107411188138879443488582977923066857609632072709215128060915602485907184270303607339537324631541580046474462631184517641617899933058407344837245596952642387851897*i + 569387074429803222772359180191534250633420819733789420757543243247458112503371533909249966746288047797795785597786138679639392429985532774541742203576102942475957825920691446419621033169758506758865788837536781560407038838017624019319181365379838646",
        "yP": "1089819410414253976017283562880574254042310601079160685679436509673065335257666622175468028205638310959126607878592229293552499609663956460077350212350228755337803365318206978208231208382726888454168992947108195462608737385545737450858104134703373658*i + 1170920365691023911835180968953898063769212497079203470915877358352189241392733218986519773071289263805893876464247021951460458942656604346466604578581182039554893278977850958742897646391769207798420098045164175686994915084218245372154498432667906937",
        "xQ": "216004443807984856984670781568237825447962785570494554352265745522321241738511430486648138712753802319521009709637515051675670338233740056988930416398282517662530860935949812704504398479605203648486320152643146555522922339788568019474258429391331366*i + 564270048954886954115551034874259355527956203580038237357258831526870430619799307343484054160726919590491760426861742972072101824175452640660615578927754967147431043672083532970630603872075970905276857215268274504068187180949808684158418823753082959",
        "yQ": "1083623872050008597086844233587159020346509837304957928280765069203183143735325717961321574509906984367159938372356923809468576641165603945117555857840734047421680225041785794303295226338699799868540534087389247295722947188003618307485335871942336059*i + 53328494435658518971825925499442267279219896166720092501151506960265076371016120912589080513721497627004125335212077579731974154753884136429840248931201627657034735814064498526706438283225421440595562205921566384557200075209599989289369182803180678",
        "xR": "863631294341733615900847428380857254937382260646986363455958324616154125790747083569808974339243551532517743015690535562210028838148057917321298137000766413253866402248601915161401695472698247882963346084828390220443496569583172589648675857593117494*i + 78229087610300567642404196213835581088765765318567148610970128179104476519656830923793913627516476240225671907115923962397088335357099798002557871643490231914538603476716561206902659491501336730873505448196403540622809666369750958629184145781040264",
        "yR": "218322258610968383953123257289542422455211864917446067570694107911441496781840628744438373592669361855530000357248986402614711648680002823441768652430761605443392070959489489396781657103752398783847306722523134087195572621495157732725220475984004462*i + 1089792013684228709119426656183621150229573551387120164657497523324146570626106927950791639956334216464611451976630475531719082039354961799591737951849681310733330358730559868625072768507529787653762125016930825792242507377980770528945462761026949214"
    },
    {
        "t": 120,
        "a": "6",
        "xP": "5566089171394128680970359770417992181358676473226528588137280876266470180614823268202454177680422112023008398060768619389213213250075929700819059769399817626335888801466355306747924102892020254158147648125465919092799746195741479873027053336325666725965569576780816121806542585*i + 18313063957915146105283418412970683580821420770407266117025657166971476095092022585323970469551588367114393466147320916090936332372915970216906842751984525988767831749468556122626232837235793306171723500499579488819634996386786794217499318740400096337527383102973865006799607850",
        "yP": "2530538146749225040006020632623524554312196172981768427584765964903672691551549838425182531892635139433702565987556661174352193824501185988729090783975057532210033574045481322453668197394326434959019800492497750150197591115519974696262915663049147841624129733824787771849708300*i + 3177947408308538319995974303667413021940352032957637375817584876904098888221689163839702493015654679133747835149463983288439942254525840246026396817886317772725188991778840613539668935608520666552871811418837185850311602456718794885517391311260482816459052303696609601466085181",
        "xQ": "16345782357076787490213719812260375169899516829951297520546210132963055152017453496556903508462395052867400366531309673116996762319067114919202771095016581102559137229029678361108074059902387886653038744037894159715563893982152863286499500231782830148774035505641348403790117877*i + 2700032220805596678045658778771535509117558198860728835775575187812441365285409280070604463054214939517474048525071504430008418870205811967000750224235119388345306917667335589066012248752789491623729802273148316480485117603009795758983288210610749567409091222830173496909183146",
        "yQ": "17456638440006796731509699873285877549628511636896980042389664531359376780217925923443766508513265574586244778599989572035150150154553414390713918013687751558920719250914897109699073799980496808207749958255783502575244630332757326735135354509102904958334493248264458126654878513*i + 18971439799495788699911292203768354565472180797992475497153927716668464488290268289653033839639595242843757715958508133488747613135028273855894610722506442739348077551144085213528528756877720962597888134899376636480996399478123997814261974008551839858555376907215629310518056448",
        "xR": "12697225697450762348022951978167092414528397028652623544905886375003614438288525562620172899792422534476468866724094184294771267538434623335042771516521911333423293638157893716607604846949507660838302015448841961698142833855309448922992178512831528133944970463905439275390351930*i + 14897697752018715871855039964753216010056578587393213918162385847368652164664945300296279703130147856098712858868440366882452061581103716892314594509342741878468622110854171012485794541507672462016655571239663075856646107238955759628091394307433119772019976383350601564159616444",
        "yR": "12842318771553069570352763041179957192306197652125058579174675319348836284419856746129352377795205383215306628617150035843933753504627431328479285857924186320075572505259099809002905724817054690821817011428430532898710875072377848664929441143620072937776699009740000072471678876*i + 18743936810478887211022492544595626725275496907015296540920634719746214249076850246800278338791477671705857237448903752212947560743696660910865630385670782403976625844163959744906705281890160474594211608118847099282476291889148729152825787829744273954068589632768416149491353308"
    },
    {
        "t": 130,
        "a": "6",
        "xP": "227691156778985479690467457750629163755473695002552000699004488426196414302978175847433657616791910957808750497206246999971134853223711278273662665130084260514347651867673058817801382091657311039262077394245455499113191646656297029971711933122619557800633145757137567482772078668853300042463964708202873715*i + 137826245104309038483190172150354409515219092925423931901101246268346655643191399310661665964420679379908627844698079857233503549121898432183899749114793533606521925987182714800356357990810343768905995332531701392677886832493068813722158154368291810210990534303310435043777624315990010856494974266180816241",
        "yP": "79411914613386545664122677191923019953011953287974977493051014955671231752206285653624014258988757917968738516666385975950439549912888893107429354429359182766017990057555621642170356391085014257728183258889300929448795929418677808871753450170013851676108007610886595278759346999986198400191144024225402496*i + 47071299380481254693891354442679638250350619685053601781815769306535840614300688331102461133879149659404408746801651805300148187127802685955751358670052989213456082021902565346638511654342943606024387309072374698089840951574402338405582688889282541450898750600199408929708692387896411484295784763841317428",
        "xQ": "232453028132018986503084767429647697965212297520936496942086620760583248682474117535368760836578093173529578574968507417285477444069293463161844476470691848074687800216496642716212730388860897062643074629479305683562738411208152012832896992541843536240129545519383455457775029464519289913834000769961745028*i + 181838586059914955943481198048793812459722281383120633180034027152276482060611820633723867440269343759274443999689567755762962008578597726347442200417303929504428753060828301313749107533603966949476731699856049251727674640881653419610851676445641040824364472159331577281436618908528969758630457586498629560",
        "yQ": "107167612144457284010019199500052691941811418529463799886796702045416094458889509945892202011093671042525431196981764506592187041081196783802649303675506446632678569367911539587323501625651162575911354272942882862345499089120559738243426816599400210563367797079586995963749954464591467196401813264393978556*i + 194145156811019556020413841382736954228127516292981183203171850240772320930690010128117474177978196948652327897805690436298964646747945248694557716345412318337271147989808877886067029187456265532511615369052377057271135323989859386595797465329601077866089232822917418534432358269551650147392700098037428578",
        "xR": "31188692815941184659479172983388087551525262955877609470730631686198957717857004016565043204036844969674807077881145783828487839416164948876723101010838781085197151375388087926778605558968334183790395522897079756734683097332724355686047652427725188137398734926007444005912255964458327194626648538216633027*i + 133007600564076355635324273120300366166561571166278541230854531731639630288759958898218430927976588688418067408030418250018218687436191520579388058910138812226984553146237067243629866315635644303047128432864337916070204644622996339688360469977962676411032731559544059269034332312265803033088437059346798274",
        "yR": "92844703589719546246554369250644937850308636963532408853504876683454494229033801280102387107635509489079868917508599711740291627368932531576188945987686578122689542555469745888281240614320068393076678548363509780229208442711776516943219985824480891738983546121215284431566581881196505059037628578024738943*i + 72252435933218778927723927781882304515554539290293785595431210745394052105090500861738553696968810055801809241715400054067718615956273281503880756712459792482740744830223194282795559518847926170182042037647112490650008732389770021022365258291383569554088369322401013750999722002879706049152279823658925931"
    },
    {
        "t": 140,
        "a": "6",
        "xP": "4313280985339192717368348050443936623386339877046809047610091486210613137764298735471118120743373115668065180644444673772992291210529364858224856393978903147785223523844034688651709272767834970201195395922211833129493036405577620026608045929657844610383642584498337962714949901175039111688793042823024538600052951509937667000927241437*i + 3919053996031042639554076715600959593974889702923937044696138917427972238757883446780428654686119881280048217752629960826916982261308386012548164412711799431537676133848846154837967228567531444021207774377426399298973814693471831441092733154548945540881162181550351969432522424983728367063009191424663164488405792501042316126896173595",
        "yP": "4039509537504474815555806609917363749832093877614379825140681252028519987489978841468499625138970955417425495239881049288045590004378584460574241226462073677429721495860833915425432954396650504106016044995738899401504109219314899266795319672013231759511333719665104825779845933535623595125728416752719712160799864608651849312833232230*i + 20962405998221019172119175669660958669136628691249440104059607504134797817463639999556014974687650493968555833571940896098102639207546046645466791979064809291444624247232440122374919796922042215176489839243331121927180982977539044279436532084547346006176690124683033553100690246371137056380708192433088614586828091388845628188561196772",
        "xQ": "12872790979744797409784189389476858398715195448078732211078062558127296552072985077483961184381213066719794598497940796678107711095464294545769766847242309160818888106112499894082015772984574491280923408635329818834025646488361035331956412192053235365426100506313146239357297015986110930613444091704036975225832132284795315133997572539*i + 4555424315058715070628114378238462839476281477351835389851485970124480250541871619694375945520503798311978386586224211520612345410716116103267255439867037419018078605550791281974469755423038876778168278378533455995152117703988815384153423604979910559446993357235055726838268082302171111629377598185274708142478352208425238555060589212",
        "yQ": "11336101689017208577553573349633397613653171091645891069743656255882760070347644336981211542385653344442030390921211701519176528417318150525110786148143246359732852045978840046038792397272352045510377991099509039478941075470274747809001323104751548892112201759569387545802745256233599612163174788355357463643669707592670047042474876415*i + 3716964349089854118804281783300667472598952739706382598729947677797612945825838044745541104365437019652343863962379932153279747980681289538766219979223779801985226675876946911093675195691950725359934242001497185707219850430479946100724793470544318865382343271826853360666728953250991628109065955812181861184032316774506962289589667906",
        "xR": "15104906862988841913897665085348182395740444027710438008164902317594597595635225714580141382027889989390658087415150910927088981421491464853705237767925627321453408142584788441366643885028868391836631907604736507607638905142899467071865682446659229454943047909967964443661160439351856675650801727076015744809484881629012361502250535227*i + 20267539827067595936556334850927751502786307801122703531590311958728108672234393573361614480609349430111045717706936443242627486856963536378141046942438254232273349192591669841716317628973671668630092644163689629539433907007622303406355521266226309731350734743874945462407252931327042845902909315034823368569695533223969859191968440040",
        "yR": "19180221459033938961912912634518151092548524075868779653750223291938099736600895259295559381717364717072548231288902969650092753780085736531715427393369920731555371326199465728328634206021547126770791155687634473465600475024588203573865319268135551253620444567191341687947282579550647545849254753199535228840654765195551819138826914289*i + 18289344067196928323647343257178803031006423247980683161941084118589558304973059583700016422153555012496740483282749085110240281107312448012562450210359449871559702653001455139178855242616621007964090190705879623249626610216955962518742304486426377832147279421464494229863934988161035116626937757690569176777230928759106740537734464103"
    },
    {
        "t": 150,
        "a": "6",
        "xP": "38875101656589648074540889910158094028510354678103911345587150585505582321958785242578068841595926468776902993905782278711459828352808401074007024768734493956027686753776545305203217410254294148326169375684899078440384234175756666655153521359202042259976400413297182402912704933974574098807509601500188392422202689698657990244848858480834839236586646737900814079*i + 107153396793510161619651452752089550257388420764403939887802142485265972168464258683338821676946678212829727414336952653688233513853236529963063136943306372810613152597147607326829968525615995725087266666044875121111398689164969491845996362384179851063147840123976290690096867520820962968145047164616725223497475226679580560037878147912556227730093546152779110299",
        "yP": "78561190336778396888883842883017070187030044831407319067010069382611846580876036527305451906894036095784396893473010564988068332386353856723237853511623869817504012242873192610461807987886878357363966291008640360454521168420447140283851399088089105997935941026145057941993224675606033184058896081048851596256461747634292621631484502763630468427204053859565754253*i + 84932153682971774153425547690543492228254284762447043562621072504806629349595665431131164065405302739276234412289893749017231715575887220775706770957356563655982259235949143393370808838922399875217896464687578213091225966896548571334858696872253458198726001961067644599205425152578175279657581760265364903655051841099701044588573587336978934654829520015721022757",
        "xQ": "112269117766658518833498996477632954497157525964135019776205011274161646594839595755042054367951407616880190382239684532547765511411458849298061637321548652703682818238733478093606128836026111620800995105789392688317009570685013041740162900039152683905953907261695157159133359739450405779246676476931971591065173710130908366648331797537988861820880532386558525833*i + 34560455866836114426562689879142194399413850715831630713142018212530727341701552090789737951555475745185639251911540733068361511652252213915337433650936374445346829820767353206435654122486142650097112392989595915316599419074683460921036153688836239799943520449363855320328040242503416907964962351715561984973226889143328125260496479613850850383305122763935142522",
        "yQ": "32904362874033314418645236970793598559844768997791013569173459728410952933682865421937428598347018490853074090796061327336637661567202430859104676976127457812832663056404372651298623689633311590222776035439853125170996509567609189534085144345911421672999518071226010932879667532810744502118859442510776293995487306760458402441127857819960292716024207517213128445*i + 77208201132927660235650743168872578760524437786551588596954664653179307982824487603837516687294307562636137517169307256670862469030283118633690174755573910273417689315901570454465518544396814056410042385882357313408099284153986217400520718790866699369987895005084776949683079554078177826084162023576360540602795770593744024371922749078148110339546275191809365435",
        "xR": "99487938342176484265664069603880954017636756939215978799606306939498797139561043036050248068550063966676311751551183007821220824915160838270151020831032463458496119938708491502504531799228825215480529771890968046616295341317398649833219951751795460039472925949346436001112033029293773704009793329533256549253123268758867467669245651725146510431975875138857494723*i + 42685977788369376479658648011386232252320858325005278593667111140204080229682097000395890568723410422951802115621510176518589516796869340420855105447095652662223148438390159553720105097869175439244988947993494591217090904906611672875077598187889725705263601070249189415307567694303474802814273828628214285601662017831048084954698647038566625545361916985972654317",
        "yR": "98762225977214884050010552049645890950082753469843752837267067723691640437503338250665921874000579786426566379130031959112988350335712150797683472864738019842024329388100701628735806250896567907906467892175632467526534325673904346832438541277038845408069410420864801939305929648647118924417369300052809823432147231403237766136098528978875824159070691516824362731*i + 120383950471196909042257666866952832433144680870015624432575310198479127547748042823904675765059571060246737283696075472659697669856480461521681347713089723923227575789085746447984367755114445770920221195256276183189507052911315341603603178167650601943095351195692319929544199022602247272048539842412447010674350704402421516734413304180070539349555606502840258006"
    },
    {
        "t": 160,
        "a": "6",
        "xP": "905928008765618541790737466128126472131610066373913758458836608362570888930245060924060835898497217626955673645010467198289148552535967423604531320581911807429725292389930466220246959071726183350544282879675703856638394507444292375011353183851322250660945990738868826125324195763255266446994982169720068639261683917468322972223009373817524973978089542520253543560316438935870698718422051827291*i + 304333733275804537895834161264781920635204761061163379538930272107326295814818170356377059403679867258575804174365793451719948496589939260354818318186735860921342699352911256905522090496040582817759779630673161732990864058406669461735806222308740729056066072611279631464216281722241611147694107050072671503523916170142881325444949396946975952495878962649919567840815329384301887230610875645901",
        "yP": "2169531090838272823675713098324490636111077215938393214058635601810715625685376040378506666717340916718328968089758724005024740389128798379792611774533029958141538265481340626537389029870577406412046244056461583528587535138570512284406268816639484177211563135831280937923447061220348642181243757184828169980051331649568132977635821978929507850041005834729934911491681081195936770461592802901891*i + 1098266890707841786368558344107534576511049551476493006106942629884552108941844637602146931681542661288759319473840691416816401507154966681917557504436368811416295054843888233325721095509490896810857449301887016566720074970944910726314320136044468974027984784977076393750459854191517070005498100263772629763018695652234731661690373775873718640916170049443991189148905699516880385790117739989271",
        "xQ": "1934667155932584826744666286625140957841815119393481333604870917338932469205357340208084677440320773993084623041249850512951016921573195306271320220909925484271702821316585239240265266510741134543681796340352436468446348454498806969809713815681610294175308880009063624386274231418704614476326250850698571586785088690144595962111643516499649204744161116646170373208496205400518062070147295267572*i + 998211019231873579391155870125740797685592231020055009347710875412979990165005056752562001253729176975584360210894473808165631142854182071749693935406174401028908419315734110375229508251343725610904048711007245146430537915152174654747543194793837218640273968662303094239469627956443019450138032449951638760729744506794352912984826120138996512141642101290983937574905849501971891811898724520749",
        "yQ": "37384269781502460269629996893862401272341503568314264899724731765973788438387793566176016631833135534103447120815304402441640220147026740393254298027583575742332037603773478090284617890670938885952269121870097947986798241547521371505410798960653387872578915486098217190496270345187850928943203494006572474610325953734603916917099535639108923947133111945055187934402753113791864973261456061583*i + 1671300752439619652355707140733680585056499323522728362801136803314179901568757770689415368989945931620540893179561425534238405269675621798414154674994866684409418354877933508066305590714559957556112806385712301080472817291135397225952069497509771664635746034031529697501981906979249877397020268155531431592911862293416900745045016782489228122038444470809605782813904082780848697853016757368327",
        "xR": "1442864198832149704174107767531403324931684300734749356940123115474175626954737039842742167917028279482565263743343725162142648865626496149593788809642597055145607967644414204673979297303432222768728658770051471836693439926307523591604068025204288631048274333869645564134899149333785710892565911082132067218204980170464103756105849095603191327223440491605937204995406508911135523924035705540361*i + 1256804059589689468549446341416107460376876264224248938091168089703465385909739349060784176692424762759632283294738959307996536235953498237369076004626490964755426895940039369922237999135872059657167600304265775821547458983189564959278989360935757446798537665009624627548529205482363844530296948162939011685748856015577593166230081331732995456166562444256314578889470225300236904641184715747801",
        "yR": "434897621713977854302716838376661836429397874988904945850431879335895564144593323508117890356718894274183063540425476455934836446353456964688038910231245338592389082773854021160335257493116243719750937937435222944365450644192676313633238643776908959903875023823553744777679869883623351611593086194599297870281315973665529058684121522414896288010407891420230651818732996120019300947991062220501*i + 962063243978307920458406401906417276221149758085254069711054801877656928716983319524586789176910403541524655609885420923126828294281389573400923960905232562757362189578797764113528389389526079060269947846791930219489056303168085093900208874592131450523862258599231359863108026265019824569692466684007012705996733922452837684660634181588920500801418280736935417754897113449977916973611457701846"
    },
    {
        "t": 170,
        "a": "6",
        "xP": "3025345277113896965241613779535610114943940323956904828393330251123254095858454076713747172408135686620791498685293232358942083455423293939996652931221724154832487133741584676051057722528834734411735758505588936021651166317224863825349933667603770648048904186477908083073045040996362584035286068870519738824334710799362467259222161532803518417222940590973581759259300771976762909074634838842346226695070562414357115629008987*i + 2726331016973689782890392965622305021856142065116066067388873534103940742219495504676447851516593852923413613127996922791380782284993240075366486367935389940794366916289760819455874998203689968641053760511823706994810695340656606045142053245046483570967125639387652692204654202694844304717702417489400374270773211962230070780415421873872008535299125558314621592156532393644750360649897832558459199956488900720335125270561811",
        "yP": "3161007285733740285246581462345279206603494177350303754159166845314763485137754059850064653983585830947313474076381174152196599958846454594912955183487615207240836209489505327916945866391317876182271374699288988255986967291962006219639744758871850075274920138474318803233644381925695715891749997287616409049862051050569392329993395535348185735329520156220456522652428617150547810202733609890700975716288322257422751473950501*i + 2211291925342026894842637876434903577424741181859463472413940938670528068044400241229676321530227041122106472111095114205438859879221089959573436540115874805921396659385600272905829254163642990318997073965035272594587386786854306938580789185969257396262362626442285056913327456827210277781090460375967180144935035752238276698370962596005170885641096228697042024632508407165774736038319370927909364580893678238891170093017839",
        "xQ": "2514517892776671145867849370510590649236859892006354936139199772610791728830850164827745737181681725059269650242529672003434872748704447609632396093692684311982406300624827841498375938885697770363697320926204602495340529229315452806185460008492536103050681569390886759043494329175405523416156903484972992411590455569243260918529292647332181575225823738628691146127071483309829094105538653252725897670453596050280458382379059*i + 114988550972301771968755558478259581498281917653656974332819962625847805378442815880000401577897566096371208894655998036466937911434699469691253207064758215685334450380215579971723836460189695581331513343207864963594070307777394107910657873794280982772192508344853128644874562748734144059436692339671568043661585191573069481228624706100178963610028176123346761346208980932400731261862156829372153817292816187291123904552319",
        "yQ": "537414573906185255938801628711606520072710690347425033738321963770129582748263838009332246205995115733443551569099427241576802314295201244832789061014969617588102501123745037666943008413913695886034291632454478414425307351281350506729591225909409862558644962748745375697277333066838794490147898580437757348070605587975310706775617422125609996694737003811015023270527486573497382756024461651354218383663129714326101603049158*i + 957485147276714184327314499873913227415174976772904992244789861170381066497247640142516548418428964997856578831153928146993139511305588500333101081011219011760989121057466509244394488885151672822958640699246759189129898971810428223223131022901597182705443722661946263218595855608692563102647890508258879033596625546777575518118181722227959543941458276422985146581031911168297160399430042245710329829302258411263051148701480",
        "xR": "1419610578428912273087354428078083824794707302631578792951110214858034635820293082154542455684224555592070294383136376289219112298841865047139406670200556558835684631399547074283110226580336283674375219872865341438169719078858044377174195829619688423250927683111414431353289043724026417287592116292190508588152361376962881292952271240713906720084341775269872847504890331977344224121110148712714986886197076163203780366110048*i + 2067237213966235230099743435560271532448792226586136765780463856880801245986701218782062686951985366068893842385654957117008914150076476127641632636863774620065996429992724641058592293183198891218873309160005890498285983614958446414209280108525177362839946890409399339104627041001909361159206917455182598238329495381320888151585683416101634214619903966167380126613635746979342166450447288549013132487852016643135850017526901",
        "yR": "1056601328919697815595531325452510139679305950923357093423300494772733475430562112430897934555388342894466635625232092337731051042484996198941748903222720122186141456335825178559019485322882533018378873296958272415729124111449729721679138772972284115359641696554835298487675175178655603659333836674425396198486714519628915903522278905022295176441695595023712921572213897315555132240563077532372824020526524013366029225367809*i + 1881931926131264116768307925553181649280998682593775865567655928251113623106514083075179252951823782250035151359600028447041423323823951093171805008486731171014872182038494117886565263160100411856554433500591775724394719490523790021273144523912744922989247445990419385048377847852036319557825035312019055015596711988122393980772605408874434458880549750011587351865485688694082195720522039777596490187449126015084940474294732"
    },
    {
        "t": 180,
        "a": "6",
        "xP": "73134163219519525827518085458688381872006527442659839549570667934473916935535301342663936794206495579144355288120126367511880119550092361156206789040376729029189229336122768844021085399839023307876873418899386484361677620050632368979462777610839259587547075457419634513400208555975068268013357287652834454629329134270714470869941321850434074218452221898231891106098678613767722324103879021121762741799279000637487598328760509405005709296878985264663981*i + 84568412208420757499831125990571430476706593937129640181972338271202998384324014144568348027221472108967085553338087401958823594842145197785820757507285720874958818046591413299564237762010317533830606562232017665299942713844399196738960424415513401493418620122025531705317741426524306426100385335233848897279912408553776602010551559622296540060674770248888167054848722558370663931643792288577862687941175927320443739115799227750954473139520628272032911",
        "yP": "115043597536751766050273899441666817276575275190216002593807934956870631655167676392542637178297257523939237884262685543509607872046892009515157817538311146531217868536943281367664743863653725239128777738868097257863648804355810652561902821964815422330429781027593526404260254346619436535609299919592882375374158031087916454197828679363028696487183011412220691416902543082758855319854092311274966925996116699634456481062347785343834292439330078588620264*i + 83059006936179483715159936102135874318219371606373890799849257635016208514752662011572047497946704633819236780932547722527521189335211944479049297832578172839683589324804831521098149180098286689890565973680896221681282329705100867470556769265750824708011031139466929999933531976850785744569001029725353060175021388413631123672616578516873807777171875744631992760917037502063191669831696764495520755594319426016474167401292660602172253751488545921141918",
        "xQ": "49482672577713064329044478489644253676676563283380586200471977525311259812039116669100856320573996075039302167790022478451255633426964492130184089255718052131281130964819444797102907926130030956096507105688801355742691692089538396034750133934535662163014618731116981637422956845622092750048163661679552043391519660897051456310843358608609103381924367462810758217008477576374725209980192320517250309942580370063785213311676325568533094233242723156041517*i + 27197649464726730081952686482967022116216609745228823673897447579983128790893767482313049205944341123166768613106439751075137394571908477884537980688472723920495880614560452512473350588115796132741071059692065410512577492034399779916153158030972262471649957898304063317611543637498511227522861313085580298807866167793536899921409483052997462376381513848008143393150134124375314385569228545860561718682354608514339632144652402737752914694777720144244309",
        "yQ": "43505782474782532454790011241275238026543748659136455520335558987324561475801846494901599449309674707995351804266606747390849585857089168086671496912449159874837020967465575650217866580358202954697648843675460411339275267991703583571199764077272104966930204612585369424327829870116705815406189858855389526357317399789292426489070729257124013091637835608909269765535737979324033405553274947547121946215271961180884054937340573273723169208136573600335121*i + 53669834827751125820786348170474668303207366078820622337507591888349372635675153010758428184419008729478098949221372812283613446323519152480309796815717970556054770978645052235627447111708007454923496547359694789364226374355621696733009544777603044597839173432384569780263216197169707971348388544143548794573367668511139446607252282011211773739221239846934307997398529845988399155955799435927068983479503093738532529410386665509422344194692722573117145",
        "xR": "27684751110732939779822168100354838961783998241123556566924377532950900291099972639539420266667739121875486902793112685483091672267018883682891092981779416043190033702870300883881206187125345695960732778633795160591887289808760709896407329414310503259868603352680177246146696030024072620446310853312840821623849169625652171198520692911245756082072282357320695248423881832680259388363600323375347413323302367037049454159783493714631394681601615513017820*i + 86555761985653531791082910278162216501286024177044376938916404930148530453606588311448712060413088190601228346564426887573061059570414100710201573030888476080375519684873776466490143455404950862109381083054630395286584403094015363228543176639548139640253883795521089383446156519410725569808184634198645749948187976359414350541634871514773829646608631606329163103988150788087052593637928761773054754381271188634850441661932377158009991094513431080732057",
        "yR": "50670969492360075482847779495070312865278221201763004252598446463242207505832208780326066649913545416188023423577735826801514351279379013156877659791470633099660990590625364559480662594906172808262786261862664415330461512036864108684959697877532867399329938197847132118426890557582639191938033647939930826871365969637420230575881359088634947548264837197126499402576283199814955620315821224549606985849657597268898432953803373337440480783853749479877917*i + 65224812526662001870247653562191957832646635083738203344004103603668036125474973541413324709218807504767681811766905891648099054855012053594524468585872840520603499462565323726038161033466932595568203740168073032499007689081461391268643466869356747314798488962086887284351777747595591321466360191689193697244621118180537163486025143372845234347673873819806030675355921107816226724964162908634002594423519840808339646195294729314642242116820551257574167"
    }
]

def run_msidh_exchange(p: int, A: int, B: int, E, P, Q):
    # Prepare the interfaces (step 0)
    A_mul = (p + 1)//A
    Alice = MSIDH(p, A, B, E0=E, P=P * A_mul, Q=Q * A_mul, is_bob=False)
    B_mul = (p + 1)//B
    Bob = MSIDH(p, A, B, E0=E, P=P * B_mul, Q=Q * B_mul, is_bob=True)

    # Calculate public key information (step 1)
    pubkey_alice = Alice.gen_pubkey(*Bob.basis)
    pubkey_bob = Bob.gen_pubkey(*Alice.basis)

    # Exchange - Calculate shared key information (step 2)
    jinv_alice = Alice.key_exchange(*pubkey_bob)
    jinv_bob = Bob.key_exchange(*pubkey_alice)

    # This will break the benchmark computations if result is incorrect
    assert jinv_alice == jinv_bob

def prep_environment(bt: MSIDHBenchTask):
    global p, A, B, i, E, P, Q

    set_random_seed(0)
    p, A, B, _ = MSIDH.gen_pub_params(bt.t)

    F = GF(p**2, names=('i',), modulus=[1, 0, 1])
    (i,) = F._first_ngens(1)
    # Montgomery Curve with 'a' as x^2 coefficient
    a = F(bt.a)
    E = EllipticCurve(F, [0, a, 0, 1, 0])
    assert E.is_supersingular()

    P = E(F(bt.xP), F(bt.yP))
    Q = E(F(bt.xQ), F(bt.yQ))
    R = E(F(bt.xR), F(bt.yR))
    assert P - Q  == R
    assert order_from_multiple(P.weil_pairing(Q, p + 1), p + 1, operation='*') == p + 1

def run_benchmark():
    global p, A, B, i, E, P, Q

    N_REPS = 5
    COL_SEP = "\t"

    print("# Sage Benchmark results for MSIDH protocol")
    headers = [ "n", "t", "time_avg", "time_median", "time_sum", "n_reps"]
    print(COL_SEP.join(headers))

    try:
        for n, bt_dict in enumerate(BENCH_TASKS):

            # Unpack the params to the function, run the context
            bt = MSIDHBenchTask.from_dict(bt_dict)
            prep_environment(bt)

            times = []

            # Run The benchmark N_REPS times
            for j in range(N_REPS):
                prep_environment(bt)
                start = timer()
                run_msidh_exchange(p, A, B, E, P, Q)
                end = timer()
                time_s = end - start 
                print(f"[{n + 1}/{len(BENCH_TASKS)}][t={bt.t}][{j+1}/{N_REPS}]: run_msidh_exchange took {time_s:.3f} seconds to execute", file=sys.stderr)
                times.append(time_s)

            # Make sure that the number of results match
            assert len(times) == N_REPS

            # Prepare the statistics:
            times = sorted(times)
            time_sum = sum(times)
            time_avg = time_sum / len(times)
            time_median = times[N_REPS//2] if N_REPS % 2 else (times[N_REPS//2] + times[(N_REPS + 1)//2])/2

            # Flush will send the result immediately to the File / stream
            print(COL_SEP.join(str(x) for x in [n + 1, bt.t,  f"{time_avg:.2f}", f"{time_median:.2f}", f"{time_sum:.2f}", N_REPS]), flush=True)
    except KeyboardInterrupt:
        print("Interrupted. Ending.", file=sys.stderr)


if __name__ == "__main__":
    run_benchmark()